(()=>{"use strict";var e,t={686:(e,t,i)=>{const a=new(i(607).aoeGame);a.loadMap("assets/mapexample.json").then((()=>{a.loadTerrain(),a.preloadGaia().then((()=>{a.loadGaia()}))}))},607:function(e,t,i){var a=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))((function(n,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((a=a.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.aoeGame=void 0;const s=i(212),r=i(886),o=i(276),l=i(733),d=i(287),h=n(i(466)),u=i(376);class c extends s.Scene{constructor(e=!1){super(),this.debug=e,this.elevationScale=.3,this._mapSize=120,this.debug=e,this._defaultRenderer=new s.WebGLRenderer,this._defaultRenderer.setClearColor(0,0),this._defaultRenderer.setPixelRatio(window.devicePixelRatio),this._defaultRenderer.setSize(window.innerWidth,window.innerHeight),this._defaultRenderer.outputEncoding=s.sRGBEncoding,this._defaultRenderer.shadowMap.enabled=!0,this._defaultRenderer.shadowMap.autoUpdate=!1,document.body.appendChild(this._defaultRenderer.domElement),this._defaultLabelRenderer=new o.CSS2DRenderer,this._defaultLabelRenderer.setSize(window.innerWidth,window.innerHeight),this._defaultLabelRenderer.domElement.style.position="absolute",this._defaultLabelRenderer.domElement.style.top="0px",document.body.appendChild(this._defaultLabelRenderer.domElement),window.addEventListener("resize",this.onWindowResize.bind(this),!1);this._defaultLights=new s.Group,this._defaultLights.add(new s.AmbientLight(4210752,.54));const t=new s.PointLight(16777215,1);t.castShadow=!0,this._defaultLights.add(t),this.add(this._defaultLights),this._defaultCamera=new s.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,1e3),this._defaultCamera.position.set(20,30,20),this.add(this._defaultCamera),this._defaultControls=new r.OrbitControls(this._defaultCamera,this._defaultLabelRenderer.domElement),this._defaultControls.target=new s.Vector3(this._mapSize/2,0,this._mapSize/2),this._defaultControls.autoRotate=!0,this._defaultControls.update(),this._stats=new h.default,this._stats.dom.style.display="none",this._datGUI=new u.GUI,this._datGUI.hide(),this.debug&&(this._datGUI.show(),this._datGUI.add(this._defaultLights.children[0],"intensity",0,2),this._datGUI.add(this._defaultLights.children[1],"intensity",0,2),this._stats.showPanel(0),this._stats.dom.style.display="block",document.body.appendChild(this._stats.dom));const i=new s.AxesHelper(5);i.name="axes",this.add(i),this.mapData={},this.models={},this.mapSize=this._mapSize,this.animate()}onWindowResize(){this._defaultCamera.aspect=window.innerWidth/window.innerHeight,this._defaultCamera.updateProjectionMatrix(),this._defaultRenderer.setSize(window.innerWidth,window.innerHeight),this._defaultLabelRenderer.setSize(window.innerWidth,window.innerHeight),this.animate()}animate(){this._stats.begin(),requestAnimationFrame(this.animate.bind(this)),this._defaultControls.update(),this._defaultRenderer.render(this,this._defaultCamera),this._defaultLabelRenderer.render(this,this._defaultCamera),this._stats.end()}loadMap(e){return a(this,void 0,void 0,(function*(){return this.mapData=yield(0,l.loadMapData)(e)}))}loadTerrain(){const e=new l.terrain(this.mapData.tiles);this.add(e)}preloadGaia(){var e;return a(this,void 0,void 0,(function*(){let t=[];null===(e=this.mapData.gaia)||void 0===e||e.filter((function(e){var i=t.findIndex((t=>t.name==e.name));if(i<=-1){let i=t.push(e);t[i-1].count=1}else t[i].count+=1;return null}));let i=[];const n=Promise.all(t.map((e=>a(this,void 0,void 0,(function*(){let t;try{t=(0,d.resolveModelPaths)(e.name)}catch(e){return void i.push(e)}const a=yield(0,l.makeInstanceAsset)(t,e.count);this.models[e.name]=a,this.models[e.name].userData.count=e.count})))));return i.length,n}))}loadGaia(){const e=new s.Object3D;this.mapData.gaia.forEach((t=>{var i,a;if(t.name){if(!this.models)throw new Error("preload gaia first. try `.preloadGaia.then(...)`");if(t.name in this.models){const i=this.getObjectByName("terrain").tiles[t.position.x-.5][t.position.y-.5].actualElevation;e.rotation.set(0,Math.random()*Math.PI*2,0),e.position.set(t.position.y-.5,i*this.elevationScale,t.position.x-.5),e.updateMatrix();this.getObjectByName("terrain").tiles;this.models[t.name].children.forEach((i=>{i.setMatrixAt(this.models[t.name].userData.count-1,e.matrix),i.instanceMatrix.needsUpdate=!0,i.castShadow=!0})),this.models[t.name].userData.count-=1}else if(this.debug){const e=new o.CSS2DObject(document.createElement("div"));e.element.textContent=t.name.slice(0,5)||"<>",e.position.set((null===(i=t.position)||void 0===i?void 0:i.y)||0,.5,(null===(a=t.position)||void 0===a?void 0:a.x)||0),this.getObjectByName("terrain").add(e)}}}));for(let e in this.models)this.add(this.models[e]);this._defaultRenderer.shadowMap.needsUpdate=!0}set mapSize(e){if(this._mapSize=e,this._defaultLights.children[1].position.set(0,200,this._mapSize/2),this._defaultControls.target=new s.Vector3(this._mapSize/2,0,this._mapSize/2),this.debug){this.remove(this.getObjectByName("grid"));const e=new s.GridHelper(this._mapSize,this._mapSize);e.name="grid",e.position.set(this._mapSize/2-.5,.1,this._mapSize/2-.5),this.add(e)}}}t.aoeGame=c},733:function(e,t,i){var a=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))((function(n,s){function r(e){try{l(a.next(e))}catch(e){s(e)}}function o(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.makeInstanceAsset=t.makeDebugObject=t.terrain=t.loadMapData=void 0;const n=i(212),s=i(47),r=i(276);function o(e,t){return Math.max(Math.min(e,t),0)}t.loadMapData=function(e){return a(this,void 0,void 0,(function*(){return(yield fetch(e)).json()}))};class l extends n.Mesh{constructor(e){super(),this.tiles=[],this.elevationScale=.3,this.mapVertices=[],this.mapUVs=[],this.geometry=new n.BufferGeometry;const t=(new n.TextureLoader).load("assets/materials/g_m14_00_color.png");t.offset=new n.Vector2(.5,.5),t.repeat.set(.1,.1),t.wrapS=n.RepeatWrapping,t.wrapT=n.RepeatWrapping,this.material=new n.MeshStandardMaterial({map:t,side:n.DoubleSide}),this.frustumCulled=!1,this.receiveShadow=!0,this.name="terrain",this.assignGeometry(e)}assignGeometry(e){var t,i,a,s,r,l,d,h,u,c,m;const p=120;this.tiles=Array(p).fill(p).map((e=>Array(p))),e.forEach((e=>this.tiles[e.position.x][e.position.y]=e));let f=Array(121).fill(121).map((e=>Array(121)));for(let e=0;e<f.length;e++)for(let t=0;t<f.length;t++)f[e][t]=Math.max(this.tiles[o(e,119)][o(t,119)].elevation,this.tiles[o(e-1,119)][o(t,119)].elevation,this.tiles[o(e-1,119)][o(t-1,119)].elevation,this.tiles[o(e,119)][o(t-1,119)].elevation);for(let e=0;e<this.tiles.length;e++)for(let o=0;o<this.tiles.length;o++){const p=[f[e+1][o]*this.elevationScale,f[e][o]*this.elevationScale,f[e][o+1]*this.elevationScale,f[e+1][o+1]*this.elevationScale];this.tiles[e][o].triangles=[];const w=p.reduce(((e,t)=>e+t))/this.elevationScale-4*this.tiles[e][o].elevation;1===w?(this.tiles[e][o].actualElevation=this.tiles[e][o].elevation+.25,p[0]||p[2]?(null===(t=this.tiles[e][o].triangles)||void 0===t||t.push(new n.Triangle(new n.Vector3(o-.5,p[0],e+.5),new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[3],e+.5))),null===(i=this.tiles[e][o].triangles)||void 0===i||i.push(new n.Triangle(new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[2],e-.5),new n.Vector3(o+.5,p[3],e+.5)))):(null===(a=this.tiles[e][o].triangles)||void 0===a||a.push(new n.Triangle(new n.Vector3(o-.5,p[0],e+.5),new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[2],e-.5))),null===(s=this.tiles[e][o].triangles)||void 0===s||s.push(new n.Triangle(new n.Vector3(o-.5,p[0],e+.5),new n.Vector3(o+.5,p[2],e-.5),new n.Vector3(o+.5,p[3],e+.5))))):3===w?(this.tiles[e][o].actualElevation=this.tiles[e][o].elevation+.75,p[0]&&p[2]?(null===(d=this.tiles[e][o].triangles)||void 0===d||d.push(new n.Triangle(new n.Vector3(o-.5,p[0],e+.5),new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[2],e-.5))),null===(h=this.tiles[e][o].triangles)||void 0===h||h.push(new n.Triangle(new n.Vector3(o-.5,p[0],e+.5),new n.Vector3(o+.5,p[2],e-.5),new n.Vector3(o+.5,p[3],e+.5)))):(null===(r=this.tiles[e][o].triangles)||void 0===r||r.push(new n.Triangle(new n.Vector3(o-.5,p[0],e+.5),new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[3],e+.5))),null===(l=this.tiles[e][o].triangles)||void 0===l||l.push(new n.Triangle(new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[2],e-.5),new n.Vector3(o+.5,p[3],e+.5))))):(this.tiles[e][o].actualElevation=2==w?this.tiles[e][o].elevation+.5:this.tiles[e][o].elevation+0,null===(u=this.tiles[e][o].triangles)||void 0===u||u.push(new n.Triangle(new n.Vector3(o-.5,p[0],e+.5),new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[3],e+.5))),null===(c=this.tiles[e][o].triangles)||void 0===c||c.push(new n.Triangle(new n.Vector3(o-.5,p[1],e-.5),new n.Vector3(o+.5,p[2],e-.5),new n.Vector3(o+.5,p[3],e+.5)))),null===(m=this.tiles[e][o].triangles)||void 0===m||m.forEach((e=>{this.mapVertices.push(...e.a.toArray(),...e.b.toArray(),...e.c.toArray()),this.mapUVs.push(e.a.toArray()[0],e.a.toArray()[2],e.b.toArray()[0],e.b.toArray()[2],e.c.toArray()[0],e.c.toArray()[2])}))}this.geometry.setAttribute("position",new n.BufferAttribute(new Float32Array(this.mapVertices),3)),this.geometry.setAttribute("uv",new n.BufferAttribute(new Float32Array(this.mapUVs),2)),this.geometry.computeVertexNormals(),this.geometry.attributes.position.needsUpdate=!0}}t.terrain=l,t.makeDebugObject=function(e,t){const i=t;i.className="label",i.textContent="Earth",i.style.marginTop="-1em";const a=new r.CSS2DObject(i);return a.position.set(0,1,0),a},t.makeInstanceAsset=function(e,t){return a(this,void 0,void 0,(function*(){const i=new s.GLTFLoader,a=yield i.loadAsync(e),r=new n.Group;return a.scene.traverse((e=>{if(e instanceof n.Mesh){const i=new n.InstancedMesh(e.geometry,e.material,t);i.name=e.name,r.add(i)}})),r}))}},287:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resolveModelPaths=t.modelPaths=void 0,t.modelPaths={rootPath:"assets/objects/","Gold Mine":"gaia/gold.glb","Stone Mine":"gaia/stone.glb",Relic:"gaia/relic.glb","Fruit Bush":"gaia/berry_bush.glb",Tree:"gaia/mapletree/mapletree.glb","Tree (Palm Forest)":"Tree","Tree (Dragon)":"Tree","Tree (Reeds)":"Tree",boar:"gaia/boar.glb",deer:"boar",javelina:"boar",Elephant:"boar",Ostrich:"boar",Zebra:"boar",rhino:"boar",ibex:"boar","iron boar":"boar",sheep:"gaia/sheep.glb",turkey:"sheep",llama:"sheep",Goat:"sheep",pig:"sheep",goose:"sheep",cow:"sheep",water_buffalo:"sheep"},t.resolveModelPaths=function e(i){if(!i)throw new Error("model name not defined");if(new RegExp(/\..*$/).test(t.modelPaths[i]))return t.modelPaths.rootPath+t.modelPaths[i];if(i in t.modelPaths)return e(t.modelPaths[i]);throw new Error("model "+i+" not found/implemented")}}},i={};function a(e){var n=i[e];if(void 0!==n)return n.exports;var s=i[e]={exports:{}};return t[e].call(s.exports,s,s.exports,a),s.exports}a.m=t,e=[],a.O=(t,i,n,s)=>{if(!i){var r=1/0;for(h=0;h<e.length;h++){for(var[i,n,s]=e[h],o=!0,l=0;l<i.length;l++)(!1&s||r>=s)&&Object.keys(a.O).every((e=>a.O[e](i[l])))?i.splice(l--,1):(o=!1,s<r&&(r=s));if(o){e.splice(h--,1);var d=n();void 0!==d&&(t=d)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[i,n,s]},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};a.O.j=t=>0===e[t];var t=(t,i)=>{var n,s,[r,o,l]=i,d=0;if(r.some((t=>0!==e[t]))){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);if(l)var h=l(a)}for(t&&t(i);d<r.length;d++)s=r[d],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(h)},i=self.webpackChunkwebaoe=self.webpackChunkwebaoe||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=a.O(void 0,[475],(()=>a(686)));n=a.O(n)})();